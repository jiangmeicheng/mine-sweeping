<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰«é›·æ¸¸æˆ</title>
  <style>
    #board {
      display: grid;
      grid-template-columns: repeat(10, 30px);
      grid-gap: 2px;
    }

    .cell {
      width: 30px;
      height: 30px;
      background-color: lightgray;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .mine {
      background-color: red;
    }
  </style>
</head>

<body>
  <h1>æ‰«é›·æ¸¸æˆ</h1>
  <p>
    <span>å…±</span>
    <span class="num_span"></span>
    <span>ä¸ªåœ°é›·</span>
  </p>
  <div id="board"></div>
  <br />
  <input type="text" id="coordinateInput" placeholder="è¾“å…¥åæ ‡ (è¡Œ,åˆ—)">
  <button id="revealButton" onclick="btnClick()">æ­å¼€æ ¼å­</button>
  <script>
    const rows = 10;
    const cols = 10;
    const minesCount = 10; // æ•´ä¸ªæ£‹ç›˜ç‚¸å¼¹æ•°
    let board = []; // æ£‹ç›˜å•å…ƒæ ¼ M ä¸ºç‚¸å¼¹ï¼Œæ•°å­—ä¸ºé™„ä»¶3*3å†…çš„ç‚¸å¼¹æ•°é‡
    let revealed = []; // æ£‹ç›˜å•å…ƒæ ¼æ­å¼€çŠ¶æ€ï¼Œfalse æœªæ­å¼€è¿‡ï¼Œtrue æ­å¼€è¿‡
    let gameOver = false;

    function initBoard () {
      // ç”Ÿæˆæ£‹ç›˜
      board = Array.from({ length: rows }, () => Array(cols).fill(0));
      revealed = Array.from({ length: rows }, () => Array(cols).fill(false));
      placeMines();
      calculateNumbers();
      renderBoard();
    }
    // éšæœºé€‰æ‹©ä½ç½®æ”¾ç½®åœ°é›·ã€‚
    function placeMines () {
      let minesPlaced = 0;
      while (minesPlaced < minesCount) {
        const row = Math.floor(Math.random() * rows);
        const col = Math.floor(Math.random() * cols);
        if (board[row][col] !== 'M') {
          board[row][col] = 'M';
          minesPlaced++;
        }
      }
    }
    // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°é‡
    function calculateNumbers () {
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (board[r][c] === 'M') continue;
          let count = 0;
          // ä»¥è‡ªå·±ä¸ºä¸­å¿ƒï¼Œ3*3çš„èŒƒå›´å†…æœ‰å¤šå°‘ç‚¸å¼¹
          for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
              const newRow = r + i;
              const newCol = c + j;
              if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols && board[newRow][newCol] === 'M') {
                count++;
              }
            }
          }
          board[r][c] = count;
        }
      }
    }

    // æ¸²æŸ“æ£‹ç›˜
    function renderBoard () {
      const boardElement = document.getElementById('board');
      boardElement.innerHTML = '';
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.onclick = function () { revealCell(r, c); };
          if (revealed[r][c]) {
            cell.textContent = board[r][c] === 'M' ? 'ğŸ’£' : board[r][c] || '0';
            if (board[r][c] === 'M') cell.classList.add('mine');
          }
          boardElement.appendChild(cell);
        }
      }
    }
    // æ­å¼€æ ¼å­
    function revealCell (r, c) {
      if (gameOver || revealed[r][c]) return;
      revealed[r][c] = true;
      if (board[r][c] === 'M') {
        // å±•ç¤ºç‚¸å¼¹æ ¼å­å†…å®¹
        renderBoard();
        setTimeout(() => {
          gameOver = true;
          alert("Game Over");
        }, 1000); // å»¶è¿Ÿ1ç§’åæ˜¾ç¤ºæ¸¸æˆç»“æŸ  
      } else {
        checkWin();
        renderBoard();
      }
    }
    // æ£€æŸ¥æ˜¯å¦æˆåŠŸæ­å¼€æ‰€æœ‰éé›·åŒºåŸŸã€‚
    function checkWin () {
      const totalCells = rows * cols;
      const revealedCells = revealed.flat().filter(Boolean).length;
      if (revealedCells === totalCells - minesCount) {
        alert("Congratulations! You Win!");
        gameOver = true;
      }
    }

    // å¤„ç†ç©å®¶è¾“å…¥åæ ‡
    function btnClick () {
      const input = document.getElementById('coordinateInput').value;
      const [row, col] = input.split(',').map(Number);
      if (row >= 0 && row < rows && col >= 0 && col < cols) {
        revealCell(row, col);
      } else {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„åæ ‡ (è¡Œ,åˆ—)");
      }
    };
    // å±•ç¤ºåœ°é›·æ•°é‡
    function renderMineNum () {
      const spanDom = document.querySelector('.num_span')
      spanDom.innerHTML = minesCount
    }

    initBoard();
    renderMineNum()
  </script>
</body>

</html>